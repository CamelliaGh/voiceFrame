<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics CSP Test</title>

    <!-- Test the CSP with Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FY0SLNS6JW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FY0SLNS6JW', {
            send_page_view: false
        });

        // Test function to verify GA is working
        function testGA() {
            if (typeof gtag === 'function') {
                console.log('✅ Google Analytics gtag function is available');
                gtag('event', 'test_event', {
                    event_category: 'test',
                    event_label: 'csp_test'
                });
                console.log('✅ Google Analytics event sent successfully');
            } else {
                console.error('❌ Google Analytics gtag function is not available');
            }
        }

        // Test when page loads
        window.addEventListener('load', testGA);
    </script>
</head>
<body>
    <h1>Google Analytics CSP Test</h1>
    <p>This page tests whether Google Analytics can load with the updated CSP configuration.</p>
    <button onclick="testGA()">Test Google Analytics</button>

    <div id="results">
        <h2>Test Results:</h2>
        <ul>
            <li>Check browser console for CSP errors</li>
            <li>Check Network tab for successful gtag.js loading</li>
            <li>Click the test button to verify gtag function availability</li>
        </ul>
    </div>

    <script>
        // Additional test - check for CSP violations
        document.addEventListener('securitypolicyviolation', function(e) {
            console.error('❌ CSP Violation:', e.violatedDirective, e.blockedURI);
        });

        // Test network connectivity to Google Analytics
        fetch('https://www.google-analytics.com/analytics.js', { mode: 'no-cors' })
            .then(() => console.log('✅ Can connect to Google Analytics'))
            .catch(err => console.error('❌ Cannot connect to Google Analytics:', err));
    </script>
</body>
</html>
